<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Maintenance Tickets</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
<main class="container">
  <h2>Maintenance Tickets</h2>
  <table id="tickets">
    <thead><tr><th>ID</th><th>Student</th><th>Room</th><th>Category</th><th>Description</th><th>Status</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>
</main>
<script src="frontend.js"></script>
<script>
  async function loadTickets(){
    const d = await apiGet('/api/maintenance');
    const tbody = document.querySelector('#tickets tbody');
    tbody.innerHTML = '';
    (d?.tickets || []).forEach(t=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${t.id}</td>
        <td>${t.student_name || t.student_id}</td>
        <td>${t.room_number || '-'}</td>
        <td>${t.category}</td>
        <td>${t.description}</td>
        <td>${t.status}</td>
        <td>
          <button data-id="${t.id}" data-s="open">Open</button>
          <button data-id="${t.id}" data-s="in_progress">In Progress</button>
          <button data-id="${t.id}" data-s="closed">Close</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
    tbody.querySelectorAll('button').forEach(b=>{
      b.onclick = async ()=>{
        await apiPut('/api/maintenance/'+b.dataset.id+'/status',{status:b.dataset.s});
        loadTickets();
      }
    });
  }
  loadTickets();
</script>
</body>
</html>
